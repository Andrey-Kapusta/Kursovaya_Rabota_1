#pragma once
#ifndef FUNC_H
#define FUNC_H

#include <math.h>
#include <stdio.h>

/**
 * Структура для хранения входных параметров анализа функции.
 *
 * Поля структуры:
 *   start - начало интервала анализа
 *   finish - конец интервала анализа
 *   step - шаг для построения таблицы значений
 *   precision - точность вычислений для поиска, производной и интеграла
 */
typedef struct {
    double start;
    double finish;
    double step;
    double precision;
} input_params_t;



/**
 * Запрашивает у пользователя параметры анализа функции.
 *
 * Запрашивает:
 *   - начало и конец интервала анализа
 *   - шаг для таблицы значений
 *   - точность вычислений
 *
 * @return структуру input_params_t с введенными пользователем значениями
 */
input_params_t get_input_params(void);



/**
 * Вычисляет сигма-сумму  для аппроксимации функции.
 *
 * @param x - аргумент функции
 * @param N - количество членов ряда
 * @return сумму ряда
 */
double sigma(double x, int n);

/**
 * Вычисляет значение кусочно-заданной функции f(x).
 *
 * Функция определена следующим образом:
 *   - при x < -2: f(x) = 1/(x*tan(x))
 *   - при -2 <= x < 2: f(x) = сигма-сумма с N=16
 *   - при x > 2: f(x) = (x**4 - 16)/(x - 2)
 *   - при x = 2: возвращает NAN (не число)
 *
 * @param x - аргумент функции
 * @return значение функции f(x)
 */
double f(double x);



/**
 * Строит таблицу значений функции на заданном интервале с заданным шагом.
 *
 * @param params - структура с параметрами (используются start, finish, step)
 * @return 1, если в таблице есть хотя бы одно определенное значение функции,
 *         0, если все значения не определены
 */
int build_table(input_params_t params);

/**
 * Находит первое значение X, при котором f(X) равно Y с заданной точностью.
 *
 * @param params - структура с параметрами (используются start, finish, precision)
 * @param y - искомое значение функции
 * @return найденное значение X или 0, если значение не найдено
 */
double find_x_by_y(input_params_t params, double y);

/**
 * Подсчитывает количество значений X на интервале, при которых f(X) равно Y с заданной точностью.
 *
 * @param params - структура с параметрами (используются start, finish, precision)
 * @param y - искомое значение функции
 * @return количество найденных значений X
 */
int count_x_by_y(input_params_t params, double y);

/**
 * Вычисляет производную функции в точке с использованием метода конечных разностей.
 *
 * @param x - точка, в которой вычисляется производная
 * @param precision - точность, она же величина приращения для вычисления производной
 * @return приближенное значение производной f'(x)
 */
double calculate_derivative(double x, double precision);

/**
 * Вычисляет определенный интеграл функции на заданном интервале методом прямоугольников.
 *
 * Количество прямоугольников определяется как 1/precision.
 *
 * @param params - структура с параметрами (используются start, finish, precision)
 * @return приближенное значение интеграла f(x)dx от start до finish
 */
double calculate_integral(input_params_t params);

#endif /* FUNC_H */